<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasks - International Partnership Institute</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .task-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .task-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .sidebar-dark {
            background: linear-gradient(180deg, #1f2937 0%, #111827 100%);
        }

        .animate-pulse-dot { 
            animation: pulse 2s infinite; 
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex h-screen bg-gray-100 overflow-hidden">
        <!-- Clean Sidebar -->
        <aside class="w-72 sidebar-dark flex flex-col">
            <!-- Logo -->
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center">
                        <i data-lucide="handshake" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">IPI</h1>
                        <p class="text-gray-400 text-sm">Dashboard</p>
                    </div>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="p-4 border-b border-gray-700">
                <form action="search-results.html">
                    <div class="relative">
                        <i data-lucide="search" class="w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2"></i>
                        <input type="search" placeholder="Search..." class="w-full pl-10 pr-4 py-2 text-sm rounded-lg bg-gray-800 border-transparent text-white placeholder-gray-400 focus:bg-gray-700 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                </form>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
                <!-- Dashboard -->
                <a href="dashboard.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span class="font-medium">Dashboard</span>
                </a>

                <!-- Find Section -->
                <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Find</p>
                <a href="find-agents.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors">
                    <i data-lucide="briefcase" class="w-5 h-5"></i>
                    <span>Find Agents</span>
                </a>
                <a href="find-universities.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors">
                    <i data-lucide="school" class="w-5 h-5"></i>
                    <span>Find Universities</span>
                </a>
                <a href="find-events.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors">
                    <i data-lucide="calendar-search" class="w-5 h-5"></i>
                    <span>Find Events</span>
                </a>

                <!-- Workspace Section -->
                <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Workspace</p>
                <a href="organization-partnerships.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors">
                    <i data-lucide="handshake" class="w-5 h-5"></i>
                    <span>Partnerships</span>
                    <span class="ml-auto bg-blue-600 text-white text-xs px-2 py-1 rounded-full" id="nav-partnerships-count">0</span>
                </a>
                <a href="targets.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors">
                    <i data-lucide="target" class="w-5 h-5"></i>
                    <span>Targets</span>
                    <span class="ml-auto bg-green-600 text-white text-xs px-2 py-1 rounded-full" id="nav-targets-count">0</span>
                </a>
                <a href="tasks.html" class="flex items-center gap-3 px-4 py-2.5 text-white bg-gray-800 rounded-lg">
                    <i data-lucide="check-square" class="w-5 h-5"></i>
                    <span>Tasks</span>
                </a>
                <a href="groups.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span>Groups</span>
                </a>
                <a href="messages.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors">
                    <i data-lucide="message-square" class="w-5 h-5"></i>
                    <span>Messages</span>
                </a>
                <a href="notifications.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span>Notifications</span>
                    <span class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full animate-pulse-dot" id="notification-badge">3</span>
                </a>
            </nav>

            <!-- User Profile -->
            <div class="p-4 border-t border-gray-700">
                <a href="profile.html" class="flex items-center gap-3 p-3 hover:bg-gray-800 rounded-lg transition-colors group">
                    <div class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center text-white font-bold text-sm" id="sidebar-avatar">GH</div>
                    <div class="flex-1 min-w-0">
                        <p class="font-semibold text-white group-hover:text-blue-200 transition-colors truncate" id="sidebar-user-name">George Hogan</p>
                        <p class="text-sm text-gray-400 truncate" id="sidebar-org-name">International Partnership Institute</p>
                    </div>
                </a>
                <button onclick="window.location.href='account-settings.html'" class="flex items-center gap-3 px-3 py-2 mt-3 w-full text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition-colors text-sm">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                    <span>Settings</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-8">
            <div class="max-w-7xl mx-auto">
                <!-- Header -->
                <div class="mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Tasks</h1>
                            <p class="text-gray-500 mt-1">Manage your partnerships and target activities</p>
                        </div>
                        <button id="add-task-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 font-medium flex items-center gap-2">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            Add Task
                        </button>
                    </div>
                </div>

                <!-- Task Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="list-todo" class="w-6 h-6 text-blue-600"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" id="total-tasks">0</p>
                                <p class="text-sm text-gray-500">Total Tasks</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="clock" class="w-6 h-6 text-orange-600"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" id="pending-tasks">0</p>
                                <p class="text-sm text-gray-500">Pending</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" id="completed-tasks">0</p>
                                <p class="text-sm text-gray-500">Completed</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="alert-circle" class="w-6 h-6 text-red-600"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" id="overdue-tasks">0</p>
                                <p class="text-sm text-gray-500">Overdue</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Task Filters -->
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 mb-8">
                    <div class="flex flex-wrap items-center gap-4">
                        <span class="text-sm font-medium text-gray-600">Quick filters:</span>
                        <button class="filter-btn active px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-medium" data-filter="all">All Tasks</button>
                        <button class="filter-btn px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium hover:bg-gray-200" data-filter="overdue">Overdue</button>
                        <button class="filter-btn px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium hover:bg-gray-200" data-filter="today">Due Today</button>
                        <button class="filter-btn px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium hover:bg-gray-200" data-filter="high-priority">High Priority</button>
                        <button id="clear-filters" class="px-3 py-1 text-sm text-gray-500 hover:text-gray-700 transition-colors">Clear All</button>
                    </div>
                </div>

                <!-- Task List -->
                <div class="space-y-4" id="tasks-container">
                    <!-- Tasks will be loaded here -->
                    <div class="animate-pulse space-y-4">
                        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-gray-200 rounded-lg"></div>
                                <div class="flex-1">
                                    <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                                    <div class="h-3 bg-gray-200 rounded w-1/2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="hidden text-center py-12">
                    <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="check-square" class="w-12 h-12 text-gray-400"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">No tasks found</h3>
                    <p class="text-gray-500 mb-6">Try adjusting your filters or create a new task.</p>
                    <button id="create-first-task" class="inline-flex items-center gap-2 bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Create Task
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Task Modal -->
    <div id="add-task-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Add New Task</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <form id="task-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Task Title</label>
                    <input type="text" id="task-title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Enter task title..." required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="task-description" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" rows="3" placeholder="Task description..."></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                        <select id="task-priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="LOW">Low</option>
                            <option value="MEDIUM" selected>Medium</option>
                            <option value="HIGH">High</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                        <select id="task-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="general">General Task</option>
                            <option value="target">Target Related</option>
                            <option value="partnership">Partnership Related</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                    <input type="date" id="task-due-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-task" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Create Task</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        let allTasks = [];
        let filteredTasks = [];
        let currentFilter = 'all';

        // Load user data and sidebar info
        async function loadUserData() {
            const token = localStorage.getItem('token') || 
                         localStorage.getItem('authToken') || 
                         localStorage.getItem('access_token') || 
                         localStorage.getItem('culturo_access_token');
                         
            if (!token) {
                // Use default data if no token
                document.getElementById("sidebar-user-name").textContent = "George Hogan";
                document.getElementById("sidebar-org-name").textContent = "International Partnership Institute";
                document.getElementById("sidebar-avatar").textContent = "GH";
                return;
            }
            
            try {
                const response = await fetch("http://127.0.0.1:8000/api/users/me", {
                    headers: { Authorization: `Bearer ${token}` },
                });

                if (response.ok) {
                    const user = await response.json();
                    
                    // Update sidebar user info
                    document.getElementById("sidebar-user-name").textContent = user.full_name || "User";
                    document.getElementById("sidebar-org-name").textContent = user.organization?.name || "No Organization";
                    
                    // Update avatar with initials
                    if (user.full_name) {
                        const initials = user.full_name.split(' ').map(n => n[0]).join('').toUpperCase();
                        document.getElementById("sidebar-avatar").textContent = initials;
                    }
                } else {
                    // Use defaults if API fails
                    document.getElementById("sidebar-user-name").textContent = "George Hogan";
                    document.getElementById("sidebar-org-name").textContent = "International Partnership Institute";
                    document.getElementById("sidebar-avatar").textContent = "GH";
                }
            } catch (error) {
                console.error("Error loading user data:", error);
                // Use defaults if error occurs
                document.getElementById("sidebar-user-name").textContent = "George Hogan";
                document.getElementById("sidebar-org-name").textContent = "International Partnership Institute";
                document.getElementById("sidebar-avatar").textContent = "GH";
            }
        }

        // Load sidebar badge counts
        async function loadSidebarData() {
            const token = localStorage.getItem('token') || 
                         localStorage.getItem('authToken') || 
                         localStorage.getItem('access_token') || 
                         localStorage.getItem('culturo_access_token');
                         
            if (!token) return;
            
            try {
                // Load partnerships count
                const partnershipsResponse = await fetch('http://127.0.0.1:8000/api/partnerships', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const partnerships = partnershipsResponse.ok ? await partnershipsResponse.json() : [];
                
                // Load targets count  
                const targetsResponse = await fetch('http://127.0.0.1:8000/api/targets', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const targets = targetsResponse.ok ? await targetsResponse.json() : [];
                
                // Update badge counts
                document.getElementById('nav-partnerships-count').textContent = partnerships.length;
                document.getElementById('nav-targets-count').textContent = targets.length;
                document.getElementById('notification-badge').textContent = '3'; // placeholder
            } catch (error) {
                console.log('Could not load sidebar counts:', error);
            }
        }

        // Initialize sample tasks (since we don't have a tasks API yet)
        function initializeTasks() {
            allTasks = [
                {
                    id: '1',
                    title: 'Follow up with University of Tokyo',
                    description: 'Send proposal for student exchange program',
                    priority: 'HIGH',
                    type: 'target',
                    status: 'pending',
                    dueDate: '2025-07-15',
                    createdAt: '2025-07-10'
                },
                {
                    id: '2',
                    title: 'Prepare partnership agreement',
                    description: 'Draft legal framework for new partnership with European schools',
                    priority: 'MEDIUM',
                    type: 'partnership',
                    status: 'pending',
                    dueDate: '2025-07-20',
                    createdAt: '2025-07-09'
                },
                {
                    id: '3',
                    title: 'Update website content',
                    description: 'Add new partnership announcements to website',
                    priority: 'LOW',
                    type: 'general',
                    status: 'completed',
                    dueDate: '2025-07-12',
                    createdAt: '2025-07-08'
                },
                {
                    id: '4',
                    title: 'Research Australian universities',
                    description: 'Find potential partners in Australia for engineering programs',
                    priority: 'MEDIUM',
                    type: 'target',
                    status: 'pending',
                    dueDate: '2025-07-10',
                    createdAt: '2025-07-05'
                }
            ];
            
            filteredTasks = [...allTasks];
            renderTasks();
            updateStats();
        }

        // Update task statistics
        function updateStats() {
            const today = new Date().toDateString();
            
            const totalTasks = allTasks.length;
            const pendingTasks = allTasks.filter(t => t.status === 'pending').length;
            const completedTasks = allTasks.filter(t => t.status === 'completed').length;
            const overdueTasks = allTasks.filter(t => 
                t.status === 'pending' && new Date(t.dueDate) < new Date(today)
            ).length;

            document.getElementById('total-tasks').textContent = totalTasks;
            document.getElementById('pending-tasks').textContent = pendingTasks;
            document.getElementById('completed-tasks').textContent = completedTasks;
            document.getElementById('overdue-tasks').textContent = overdueTasks;
        }

        // Filter tasks
        function filterTasks(filter) {
            currentFilter = filter;
            const today = new Date().toDateString();
            
            switch (filter) {
                case 'overdue':
                    filteredTasks = allTasks.filter(t => 
                        t.status === 'pending' && new Date(t.dueDate) < new Date(today)
                    );
                    break;
                case 'today':
                    filteredTasks = allTasks.filter(t => 
                        new Date(t.dueDate).toDateString() === today
                    );
                    break;
                case 'high-priority':
                    filteredTasks = allTasks.filter(t => t.priority === 'HIGH');
                    break;
                default:
                    filteredTasks = [...allTasks];
            }
            
            renderTasks();
            updateFilterButtons();
        }

        // Update filter button states
        function updateFilterButtons() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-indigo-100', 'text-indigo-700');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            
            const activeBtn = document.querySelector(`[data-filter="${currentFilter}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-100', 'text-gray-700');
                activeBtn.classList.add('active', 'bg-indigo-100', 'text-indigo-700');
            }
        }

        // Render tasks
        function renderTasks() {
            const container = document.getElementById('tasks-container');
            const emptyState = document.getElementById('empty-state');

            if (filteredTasks.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            container.innerHTML = filteredTasks.map(task => `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 task-card">
                    <div class="flex items-start gap-4">
                        <button onclick="toggleTaskStatus('${task.id}')" class="mt-1 flex-shrink-0">
                            <div class="w-6 h-6 rounded border-2 ${task.status === 'completed' ? 'bg-green-500 border-green-500' : 'border-gray-300 hover:border-green-400'} flex items-center justify-center">
                                ${task.status === 'completed' ? '<i data-lucide="check" class="w-4 h-4 text-white"></i>' : ''}
                            </div>
                        </button>
                        
                        <div class="flex-1">
                            <div class="flex items-start justify-between mb-2">
                                <h3 class="font-semibold text-gray-900 ${task.status === 'completed' ? 'line-through text-gray-500' : ''}">${task.title}</h3>
                                <div class="flex items-center gap-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${getPriorityClass(task.priority)}">${task.priority}</span>
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${getTypeClass(task.type)}">${getTypeLabel(task.type)}</span>
                                </div>
                            </div>
                            
                            <p class="text-gray-600 text-sm mb-3 ${task.status === 'completed' ? 'line-through' : ''}">${task.description}</p>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4 text-sm text-gray-500">
                                    <span class="flex items-center gap-1">
                                        <i data-lucide="calendar" class="w-4 h-4"></i>
                                        Due: ${formatDate(task.dueDate)}
                                    </span>
                                    ${isOverdue(task) ? '<span class="text-red-500 font-medium">Overdue</span>' : ''}
                                </div>
                                
                                <div class="flex items-center gap-2">
                                    <button onclick="editTask('${task.id}')" class="p-1 text-gray-400 hover:text-indigo-600">
                                        <i data-lucide="edit" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="deleteTask('${task.id}')" class="p-1 text-gray-400 hover:text-red-600">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Re-initialize Lucide icons
            lucide.createIcons();
        }

        // Helper functions
        function getPriorityClass(priority) {
            switch (priority) {
                case 'HIGH': return 'bg-red-100 text-red-800';
                case 'MEDIUM': return 'bg-yellow-100 text-yellow-800';
                case 'LOW': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getTypeClass(type) {
            switch (type) {
                case 'target': return 'bg-blue-100 text-blue-800';
                case 'partnership': return 'bg-purple-100 text-purple-800';
                case 'general': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getTypeLabel(type) {
            switch (type) {
                case 'target': return 'Target';
                case 'partnership': return 'Partnership';
                case 'general': return 'General';
                default: return 'General';
            }
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString();
        }

        function isOverdue(task) {
            const today = new Date().toDateString();
            return task.status === 'pending' && new Date(task.dueDate) < new Date(today);
        }

        // Task actions
        function toggleTaskStatus(taskId) {
            const task = allTasks.find(t => t.id === taskId);
            if (task) {
                task.status = task.status === 'completed' ? 'pending' : 'completed';
                renderTasks();
                updateStats();
            }
        }

        function editTask(taskId) {
            // For now, just show an alert - could implement edit modal later
            alert(`Edit task feature would open for task ID: ${taskId}`);
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                allTasks = allTasks.filter(t => t.id !== taskId);
                filteredTasks = filteredTasks.filter(t => t.id !== taskId);
                renderTasks();
                updateStats();
            }
        }

        function addTask(taskData) {
            const newTask = {
                id: Date.now().toString(),
                ...taskData,
                status: 'pending',
                createdAt: new Date().toISOString().split('T')[0]
            };
            
            allTasks.unshift(newTask);
            filterTasks(currentFilter); // Re-apply current filter
            updateStats();
        }

        // Modal functions
        function openAddTaskModal() {
            document.getElementById('add-task-modal').classList.remove('hidden');
        }

        function closeAddTaskModal() {
            document.getElementById('add-task-modal').classList.add('hidden');
            document.getElementById('task-form').reset();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('token') || 
                         localStorage.getItem('authToken') || 
                         localStorage.getItem('access_token') || 
                         localStorage.getItem('culturo_access_token');
            
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            await loadUserData();
            await loadSidebarData();
            initializeTasks();
            lucide.createIcons();
        });

        // Filter button events
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                filterTasks(btn.dataset.filter);
            });
        });

        // Clear filters
        document.getElementById('clear-filters').addEventListener('click', () => {
            filterTasks('all');
        });

        // Modal events
        document.getElementById('add-task-btn').addEventListener('click', openAddTaskModal);
        document.getElementById('create-first-task').addEventListener('click', openAddTaskModal);
        document.getElementById('close-modal').addEventListener('click', closeAddTaskModal);
        document.getElementById('cancel-task').addEventListener('click', closeAddTaskModal);

        // Form submission
        document.getElementById('task-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const taskData = {
                title: document.getElementById('task-title').value,
                description: document.getElementById('task-description').value,
                priority: document.getElementById('task-priority').value,
                type: document.getElementById('task-type').value,
                dueDate: document.getElementById('task-due-date').value
            };
            
            if (taskData.title.trim()) {
                addTask(taskData);
                closeAddTaskModal();
            }
        });

        // Close modal when clicking outside
        document.getElementById('add-task-modal').addEventListener('click', (e) => {
            if (e.target.id === 'add-task-modal') {
                closeAddTaskModal();
            }
        });
    </script>
</body>
</html>