<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Partnership - Culturo</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex h-screen bg-gray-100 overflow-hidden">
        <!-- Sidebar Navigation -->
        <aside class="w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col">
            <!-- Logo -->
            <div class="h-16 flex items-center justify-center px-4 border-b border-gray-200 flex-shrink-0">
                <a href="dashboard.html" class="font-bold text-2xl text-gray-900 flex items-center gap-2">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-indigo-600"><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <span>Culturo</span>
                </a>
            </div>
            <!-- Search Bar -->
            <div class="p-4 border-b border-gray-200">
                <form action="search-results.html">
                    <div class="relative">
                        <i data-lucide="search" class="w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2"></i>
                        <input type="search" placeholder="Search..." class="w-full pl-10 pr-4 py-2 text-sm rounded-lg bg-gray-100 border-transparent focus:bg-white focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                </form>
            </div>
            <!-- Nav Links -->
            <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
                <a href="dashboard.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span>Dashboard</span>
                </a>
                <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Find</p>
                <a href="find-agents.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <i data-lucide="briefcase" class="w-5 h-5"></i>
                    <span>Find Agents</span>
                </a>
                <a href="find-universities.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <i data-lucide="school" class="w-5 h-5"></i>
                    <span>Find Universities</span>
                </a>
                <a href="find-events.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <i data-lucide="calendar-search" class="w-5 h-5"></i>
                    <span>Find Events</span>
                </a>
                <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Workspace</p>
                <a href="organization-partnerships.html" class="flex items-center gap-3 px-4 py-2.5 bg-indigo-50 text-indigo-700 font-semibold rounded-lg">
                    <i data-lucide="handshake" class="w-5 h-5"></i>
                    <span>Partnerships</span>
                </a>
                <a href="targets.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <i data-lucide="target" class="w-5 h-5"></i>
                    <span>Targets</span>
                </a>
                <a href="groups.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span>Groups</span>
                </a>
                <a href="messages.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <i data-lucide="message-square" class="w-5 h-5"></i>
                    <span>Messages</span>
                </a>
                <a href="notifications.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span>Notifications</span>
                </a>
            </nav>
            <!-- User Profile -->
            <div class="px-4 py-6 border-t border-gray-200">
                <a href="profile.html" class="flex items-center gap-3 group">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold text-sm" id="sidebar-avatar">GH</div>
                    <div>
                        <p id="sidebar-user-name" class="font-semibold text-gray-800 group-hover:text-indigo-600">George Hogan</p>
                        <p id="sidebar-org-name" class="text-sm text-gray-500">Global University</p>
                    </div>
                </a>
                <a href="account-settings.html" class="flex items-center gap-3 px-4 py-2.5 mt-4 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                    <span>Settings</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto">
            <div class="max-w-4xl mx-auto p-8">
                <!-- Header -->
                <div class="mb-8">
                    <div class="flex items-center gap-4 mb-4">
                        <a href="organization-partnerships.html" class="text-gray-500 hover:text-gray-700">
                            <i data-lucide="arrow-left" class="w-6 h-6"></i>
                        </a>
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Add Partnership</h1>
                            <p class="text-gray-500 mt-1">Create a new partnership agreement with another organization</p>
                        </div>
                    </div>
                </div>

                <!-- Partnership Creation Options -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Option 1: From Existing Target -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center">
                                <i data-lucide="target" class="w-6 h-6 text-indigo-600"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">From Existing Target</h3>
                                <p class="text-sm text-gray-500">Convert a target organization into a partnership</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Choose from organizations you've already been tracking in your pipeline.</p>
                        <button onclick="showTargetSelection()" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 font-medium">
                            Select from Targets
                        </button>
                    </div>

                    <!-- Option 2: New Organization -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center">
                                <i data-lucide="building-2" class="w-6 h-6 text-emerald-600"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">New Organization</h3>
                                <p class="text-sm text-gray-500">Add a completely new partner organization</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Start fresh with an organization that's not in your system yet.</p>
                        <button onclick="showNewPartnershipForm()" class="w-full bg-emerald-600 text-white py-3 px-4 rounded-lg hover:bg-emerald-700 font-medium">
                            Add New Partner
                        </button>
                    </div>
                </div>

                <!-- Target Selection Modal -->
                <div id="target-selection" class="hidden">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Select Target Organization</h3>
                            <button onclick="hideTargetSelection()" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-3" id="targets-list">
                            <!-- Target options will be loaded here -->
                            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="selectTarget('maplewood')">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <span class="text-blue-600 font-bold text-lg">MU</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900">Maplewood University</h4>
                                        <p class="text-sm text-gray-500">Canada • University</p>
                                        <div class="flex items-center gap-2 mt-1">
                                            <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs font-medium">Discussion</span>
                                            <span class="text-xs text-gray-400">Due: Jan 15, 2025</span>
                                        </div>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="selectTarget('toronto-college')">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                        <span class="text-green-600 font-bold text-lg">TC</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900">Toronto Community College</h4>
                                        <p class="text-sm text-gray-500">Canada • Community College</p>
                                        <div class="flex items-center gap-2 mt-1">
                                            <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs font-medium">Proposal</span>
                                            <span class="text-xs text-gray-400">Due: Jan 20, 2025</span>
                                        </div>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                                </div>
                            </div>

                            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="selectTarget('vancouver-institute')">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                                        <span class="text-indigo-600 font-bold text-lg">VI</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900">Vancouver Language Institute</h4>
                                        <p class="text-sm text-gray-500">Canada • Language School</p>
                                        <div class="flex items-center gap-2 mt-1">
                                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium">Initial Contact</span>
                                            <span class="text-xs text-gray-400">Due: Jan 12, 2025</span>
                                        </div>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Partnership Form -->
                <div id="partnership-form" class="hidden">
                    <form id="add-partnership-form">
                        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8 space-y-8">
                            <!-- Selected Partner Info (if from target) -->
                            <div id="selected-partner-info" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="info" class="w-5 h-5 text-blue-600"></i>
                                    <div>
                                        <p class="text-sm font-medium text-blue-900">Partner Organization Selected</p>
                                        <p class="text-sm text-blue-700" id="selected-partner-name">Organization details loaded from targets</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Partner Organization Details -->
                            <div id="partner-details-section">
                                <h3 class="text-xl font-semibold text-gray-900 mb-4">Partner Organization</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="partner-name" class="block text-sm font-medium text-gray-700 mb-2">Organization Name *</label>
                                        <input type="text" id="partner-name" name="partner-name" required 
                                               class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                                               placeholder="e.g., Maplewood University">
                                    </div>
                                    <div>
                                        <label for="partner-country" class="block text-sm font-medium text-gray-700 mb-2">Country *</label>
                                        <select id="partner-country" name="partner-country" required 
                                                class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="">Select Country</option>
                                            <option value="Canada">Canada</option>
                                            <option value="United States">United States</option>
                                            <option value="United Kingdom">United Kingdom</option>
                                            <option value="Australia">Australia</option>
                                            <option value="Germany">Germany</option>
                                            <option value="France">France</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="partner-type" class="block text-sm font-medium text-gray-700 mb-2">Organization Type *</label>
                                        <select id="partner-type" name="partner-type" required 
                                                class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="">Select Type</option>
                                            <option value="University">University</option>
                                            <option value="Community College">Community College</option>
                                            <option value="Institute">Institute</option>
                                            <option value="Language School">Language School</option>
                                            <option value="Education Agency">Education Agency</option>
                                            <option value="Government Agency">Government Agency</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="partner-website" class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                                        <input type="url" id="partner-website" name="partner-website" 
                                               class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                                               placeholder="https://www.example.edu">
                                    </div>
                                </div>
                            </div>

                            <!-- Partnership Details -->
                            <div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-4">Partnership Details</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="partnership-type" class="block text-sm font-medium text-gray-700 mb-2">Partnership Type *</label>
                                        <select id="partnership-type" name="partnership-type" required 
                                                class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="">Select Partnership Type</option>
                                            <option value="Student Recruitment">Student Recruitment</option>
                                            <option value="Articulation Agreement">Articulation Agreement</option>
                                            <option value="Joint Program">Joint Program</option>
                                            <option value="Exchange Program">Exchange Program</option>
                                            <option value="Research Collaboration">Research Collaboration</option>
                                            <option value="Faculty Exchange">Faculty Exchange</option>
                                            <option value="Pathway Program">Pathway Program</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="partnership-status" class="block text-sm font-medium text-gray-700 mb-2">Initial Status *</label>
                                        <select id="partnership-status" name="partnership-status" required 
                                                class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="PENDING">Pending Agreement</option>
                                            <option value="ACTIVE">Active Partnership</option>
                                            <option value="DRAFT">Draft/Planning</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="agreement-end-date" class="block text-sm font-medium text-gray-700 mb-2">Agreement End Date</label>
                                        <input type="date" id="agreement-end-date" name="agreement-end-date" 
                                               class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label for="internal-manager" class="block text-sm font-medium text-gray-700 mb-2">Internal Manager *</label>
                                        <select id="internal-manager" name="internal-manager" required 
                                                class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                            <option value="">Select Manager</option>
                                            <option value="current-user">George Hogan (You)</option>
                                            <!-- Other team members would be loaded from API -->
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Primary Contact Information -->
                            <div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-4">Primary Contact</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="contact-name" class="block text-sm font-medium text-gray-700 mb-2">Contact Name *</label>
                                        <input type="text" id="contact-name" name="contact-name" required 
                                               class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                                               placeholder="e.g., Dr. David Chen">
                                    </div>
                                    <div>
                                        <label for="contact-title" class="block text-sm font-medium text-gray-700 mb-2">Title/Position</label>
                                        <input type="text" id="contact-title" name="contact-title" 
                                               class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                                               placeholder="e.g., Director of International Affairs">
                                    </div>
                                    <div>
                                        <label for="contact-email" class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                                        <input type="email" id="contact-email" name="contact-email" required 
                                               class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                                               placeholder="contact@partner.edu">
                                    </div>
                                    <div>
                                        <label for="contact-phone" class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                                        <input type="tel" id="contact-phone" name="contact-phone" 
                                               class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                                               placeholder="+1 (555) 123-4567">
                                    </div>
                                </div>
                            </div>

                            <!-- Notes -->
                            <div>
                                <label for="partnership-notes" class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                                <textarea id="partnership-notes" name="partnership-notes" rows="4" 
                                          class="w-full px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                                          placeholder="Any additional notes about this partnership..."></textarea>
                            </div>

                            <!-- Form Actions -->
                            <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                                <button type="button" onclick="cancelForm()" class="text-gray-500 hover:text-gray-700 font-medium">
                                    Cancel
                                </button>
                                <div class="flex gap-3">
                                    <button type="button" onclick="saveDraft()" class="bg-gray-100 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-200 font-medium">
                                        Save as Draft
                                    </button>
                                    <button type="button" onclick="proposePartnership()" class="bg-amber-600 text-white px-6 py-3 rounded-lg hover:bg-amber-700 font-semibold">
                                        Propose Partnership
                                    </button>
                                    <button type="submit" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 font-semibold">
                                        Create New Partnership
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            loadUserData();
        });

        // Show target selection
        function showTargetSelection() {
            document.getElementById('target-selection').classList.remove('hidden');
            document.getElementById('partnership-form').classList.add('hidden');
        }

        // Hide target selection
        function hideTargetSelection() {
            document.getElementById('target-selection').classList.add('hidden');
        }

        // Show new partnership form
        function showNewPartnershipForm() {
            document.getElementById('partnership-form').classList.remove('hidden');
            document.getElementById('target-selection').classList.add('hidden');
            document.getElementById('selected-partner-info').classList.add('hidden');
            document.getElementById('partner-details-section').classList.remove('hidden');
        }

        // Select target and show form with pre-filled data
        function selectTarget(targetId) {
            const targetData = {
                'maplewood': {
                    name: 'Maplewood University',
                    country: 'Canada',
                    type: 'University',
                    website: 'https://www.maplewood.edu'
                },
                'toronto-college': {
                    name: 'Toronto Community College',
                    country: 'Canada',
                    type: 'Community College',
                    website: 'https://www.torontocollege.ca'
                },
                'vancouver-institute': {
                    name: 'Vancouver Language Institute',
                    country: 'Canada',
                    type: 'Language School',
                    website: 'https://www.vli.ca'
                }
            };

            const target = targetData[targetId];
            if (target) {
                // Show form with pre-filled data
                document.getElementById('partnership-form').classList.remove('hidden');
                document.getElementById('target-selection').classList.add('hidden');
                document.getElementById('selected-partner-info').classList.remove('hidden');
                document.getElementById('partner-details-section').classList.add('hidden');
                
                // Update selected partner info
                document.getElementById('selected-partner-name').textContent = target.name;
                
                // Pre-fill form fields (these would be readonly/hidden when from target)
                document.getElementById('partner-name').value = target.name;
                document.getElementById('partner-country').value = target.country;
                document.getElementById('partner-type').value = target.type;
                document.getElementById('partner-website').value = target.website;
            }
        }

        // Cancel form
        function cancelForm() {
            if (confirm('Are you sure you want to cancel? Any unsaved changes will be lost.')) {
                window.location.href = 'organization-partnerships.html';
            }
        }

        // Propose partnership (sends proposal instead of creating active partnership)
        function proposePartnership() {
            const formData = collectFormData();
            formData.status = 'PENDING';
            formData.proposal = true;
            
            console.log('Proposing partnership:', formData);
            alert('Partnership proposal sent! The partner organization will be notified and can accept or decline.');
            
            // In real implementation, this would send a proposal
            // proposePartnershipToOrganization(formData);
        }
        function saveDraft() {
            const formData = collectFormData();
            formData.status = 'DRAFT';
            
            console.log('Saving draft partnership:', formData);
            alert('Partnership saved as draft! You can continue editing it later.');
            
            // In real implementation, this would save to backend
            // savePartnership(formData, true);
        }

        // Handle form submission
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('add-partnership-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Creating...';
                submitBtn.disabled = true;
                
                try {
                    const formData = collectFormData();
                    console.log('Creating partnership:', formData);
                    
                    // In real implementation, this would call the API
                    await createPartnership(formData);
                    
                    alert('Partnership created successfully!');
                    window.location.href = 'organization-partnerships.html';
                    
                } catch (error) {
                    console.error('Error creating partnership:', error);
                    alert('Error creating partnership. Please try again.');
                } finally {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            });
        });

        // Collect form data
        function collectFormData() {
            return {
                partner_organization: {
                    name: document.getElementById('partner-name').value,
                    country: document.getElementById('partner-country').value,
                    type: document.getElementById('partner-type').value,
                    website: document.getElementById('partner-website').value
                },
                agreement_type: document.getElementById('partnership-type').value,
                status: document.getElementById('partnership-status').value,
                agreement_end_date: document.getElementById('agreement-end-date').value,
                internal_manager_id: document.getElementById('internal-manager').value,
                primary_contact: {
                    name: document.getElementById('contact-name').value,
                    title: document.getElementById('contact-title').value,
                    email: document.getElementById('contact-email').value,
                    phone: document.getElementById('contact-phone').value
                },
                notes: document.getElementById('partnership-notes').value
            };
        }

        // Create partnership (API call)
        async function createPartnership(partnershipData) {
            const token = localStorage.getItem('authToken');
            
            if (!token) {
                throw new Error('Not authenticated');
            }
            
            // First, create or find the partner organization
            const orgResponse = await fetch('http://127.0.0.1:8000/api/organizations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    name: partnershipData.partner_organization.name,
                    country: partnershipData.partner_organization.country,
                    organization_type: partnershipData.partner_organization.type,
                    website: partnershipData.partner_organization.website
                })
            });
            
            if (!orgResponse.ok) {
                throw new Error('Failed to create partner organization');
            }
            
            const partnerOrg = await orgResponse.json();
            
            // Then create the partnership
            const partnershipResponse = await fetch('http://127.0.0.1:8000/api/partnerships', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    partner_organization_id: partnerOrg.id,
                    agreement_type: partnershipData.agreement_type,
                    agreement_end_date: partnershipData.agreement_end_date,
                    status: partnershipData.status
                })
            });
            
            if (!partnershipResponse.ok) {
                throw new Error('Failed to create partnership');
            }
            
            return await partnershipResponse.json();
        }

        // Load user data for sidebar and form
        async function loadUserData() {
            const token = localStorage.getItem('authToken');
            if (!token) return;

            try {
                const response = await fetch('http://127.0.0.1:8000/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const userData = await response.json();
                    
                    // Update sidebar
                    document.getElementById('sidebar-user-name').textContent = userData.fullName;
                    document.getElementById('sidebar-org-name').textContent = userData.organization?.name || 'No Organization';
                    
                    // Update avatar
                    const initials = userData.fullName.split(' ').map(n => n[0]).join('').toUpperCase();
                    document.getElementById('sidebar-avatar').textContent = initials;
                    
                    // Set current user as default internal manager
                    const managerSelect = document.getElementById('internal-manager');
                    managerSelect.innerHTML = `<option value="${userData.id}">${userData.fullName} (You)</option>`;
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Set default end date to 1 year from today
        document.addEventListener('DOMContentLoaded', function() {
            const endDateInput = document.getElementById('agreement-end-date');
            const oneYearFromNow = new Date();
            oneYearFromNow.setFullYear(oneYearFromNow.getFullYear() + 1);
            endDateInput.value = oneYearFromNow.toISOString().split('T')[0];
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape key to cancel
            if (e.key === 'Escape') {
                cancelForm();
            }
        });
    </script>
</body>
</html>