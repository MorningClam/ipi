<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - Culturo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .notification-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .notification-item:hover {
            transform: translateX(4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .notification-item.unread {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.03) 0%, rgba(255, 255, 255, 1) 20%);
        }
        .priority-high {
            border-left: 4px solid #ef4444;
        }
        .priority-medium {
            border-left: 4px solid #f59e0b;
        }
        .priority-low {
            border-left: 4px solid #10b981;
        }
        .floating-filter {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
        }
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        .mark-read {
            transition: all 0.2s ease;
            opacity: 0;
        }
        .notification-item:hover .mark-read {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Sidebar -->
    <aside class="fixed inset-y-0 left-0 z-50 w-64 bg-white/95 backdrop-blur-md border-r border-gray-200/80 flex flex-col shadow-lg">
        <!-- Logo -->
        <div class="h-16 flex items-center justify-center px-4 border-b border-gray-200/80">
            <a href="dashboard.html" class="font-bold text-2xl text-gray-900 flex items-center gap-2">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-indigo-600">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Culturo</span>
            </a>
        </div>

        <!-- Search Bar -->
        <div class="p-4 border-b border-gray-200">
            <form action="search-results.html">
                <div class="relative">
                    <i data-lucide="search" class="w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2"></i>
                    <input type="search" placeholder="Search..." class="w-full pl-10 pr-4 py-2 text-sm rounded-lg bg-gray-100 border-transparent focus:bg-white focus:border-indigo-500 focus:ring-indigo-500">
                </div>
            </form>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
            <!-- Dashboard -->
            <a href="dashboard.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span>Dashboard</span>
            </a>

            <!-- Find Section -->
            <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Find</p>
            <a href="find-agents.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                <i data-lucide="briefcase" class="w-5 h-5"></i>
                <span>Find Agents</span>
            </a>
            <a href="find-universities.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                <i data-lucide="school" class="w-5 h-5"></i>
                <span>Find Universities</span>
            </a>
            <a href="find-events.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                <i data-lucide="calendar-search" class="w-5 h-5"></i>
                <span>Find Events</span>
            </a>

            <!-- Workspace Section -->
            <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Workspace</p>
            <a href="organization-partnerships.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                <i data-lucide="handshake" class="w-5 h-5"></i>
                <span>Partnerships</span>
            </a>
            <a href="targets.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                <i data-lucide="target" class="w-5 h-5"></i>
                <span>Targets</span>
            </a>
            <a href="groups.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                <i data-lucide="users" class="w-5 h-5"></i>
                <span>Groups</span>
            </a>
            <a href="messages.html" class="flex items-center gap-3 px-4 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                <i data-lucide="message-square" class="w-5 h-5"></i>
                <span>Messages</span>
            </a>
            <a href="notifications.html" class="flex items-center gap-3 px-4 py-2.5 bg-indigo-50 text-indigo-700 font-semibold rounded-lg">
                <i data-lucide="bell" class="w-5 h-5"></i>
                <span>Notifications</span>
                <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full ml-auto">8</span>
            </a>
        </nav>

        <!-- User Profile -->
        <div class="px-4 py-6 border-t border-gray-200/80">
            <a href="profile.html" class="flex items-center gap-3 group">
                <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold text-sm" id="sidebar-avatar">GH</div>
                <div>
                    <p class="font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors" id="sidebar-user-name">George Hogan</p>
                    <p class="text-sm text-gray-500" id="sidebar-org-name">Global University</p>
                </div>
            </a>
            <a href="account-settings.html" class="flex items-center gap-3 px-4 py-2.5 mt-4 text-gray-600 hover:bg-gray-100 rounded-lg">
                <i data-lucide="settings" class="w-5 h-5"></i>
                <span>Settings</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="ml-64 min-h-screen">
        <!-- Header -->
        <div class="bg-white border-b border-gray-200 px-8 py-6">
            <div class="max-w-6xl mx-auto">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">Notifications</h1>
                        <p class="text-gray-600">Stay updated on partnership proposals, messages, and important updates</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="markAllRead()" class="text-indigo-600 hover:text-indigo-700 font-medium text-sm flex items-center gap-2">
                            <i data-lucide="check-circle" class="w-4 h-4"></i>
                            Mark all as read
                        </button>
                        <button onclick="openSettings()" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg">
                            <i data-lucide="settings" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="floating-filter sticky top-0 z-40 px-8 py-4 border-b border-gray-200/50">
            <div class="max-w-6xl mx-auto">
                <div class="flex items-center justify-between">
                    <!-- Filter Tabs -->
                    <div class="flex items-center gap-1 bg-gray-100 rounded-xl p-1">
                        <button class="notification-filter-btn active px-4 py-2 text-sm font-medium rounded-lg bg-white text-gray-900 shadow-sm" data-filter="all">
                            All <span class="ml-1 text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full">23</span>
                        </button>
                        <button class="notification-filter-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:text-gray-900" data-filter="unread">
                            Unread <span class="ml-1 text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full">8</span>
                        </button>
                        <button class="notification-filter-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:text-gray-900" data-filter="partnerships">
                            Partnerships <span class="ml-1 text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">5</span>
                        </button>
                        <button class="notification-filter-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:text-gray-900" data-filter="messages">
                            Messages <span class="ml-1 text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full">7</span>
                        </button>
                        <button class="notification-filter-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:text-gray-900" data-filter="groups">
                            Groups <span class="ml-1 text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full">4</span>
                        </button>
                        <button class="notification-filter-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:text-gray-900" data-filter="system">
                            System <span class="ml-1 text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full">7</span>
                        </button>
                    </div>

                    <!-- Search -->
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"></i>
                        <input type="text" id="search-notifications" placeholder="Search notifications..." 
                               class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent w-64">
                    </div>
                </div>
            </div>
        </div>

        <!-- Notifications Content -->
        <div class="px-8 py-6 max-w-6xl mx-auto">
            <!-- Today Section -->
            <div class="mb-8">
                <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <span class="pulse-dot w-2 h-2 bg-green-500 rounded-full"></span>
                    Today
                </h2>
                <div class="space-y-2" id="today-notifications">
                    <!-- High Priority Partnership Proposal -->
                    <div class="notification-item unread priority-high bg-white rounded-xl shadow-sm border border-gray-200 p-6 cursor-pointer" data-type="partnerships" data-read="false" onclick="markAsRead(this)">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-pink-600 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i data-lucide="handshake" class="w-6 h-6 text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h3 class="font-semibold text-gray-900 text-sm">New Partnership Proposal</h3>
                                        <p class="text-xs text-gray-500 mt-0.5">High Priority</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-gray-400">5 min ago</span>
                                        <button class="mark-read p-1 text-gray-400 hover:text-gray-600 rounded">
                                            <i data-lucide="check" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-700 mb-3"><span class="font-medium">Vietnam Edu-Connect</span> has sent you a partnership proposal for student exchange programs.</p>
                                <div class="flex items-center gap-3">
                                    <button class="bg-green-600 text-white text-xs font-medium px-4 py-2 rounded-lg hover:bg-green-700 transition-all">
                                        Review Proposal
                                    </button>
                                    <button class="bg-gray-100 text-gray-700 text-xs font-medium px-4 py-2 rounded-lg hover:bg-gray-200 transition-all">
                                        Decline
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Message Notification -->
                    <div class="notification-item unread priority-medium bg-white rounded-xl shadow-sm border border-gray-200 p-6 cursor-pointer" data-type="messages" data-read="false" onclick="markAsRead(this)">
                        <div class="flex items-start gap-4">
                            <div class="relative">
                                <img class="w-12 h-12 rounded-xl" src="https://placehold.co/100x100/f472b6/ffffff?text=BC" alt="Ben Carter">
                                <span class="absolute -top-1 -right-1 w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center">
                                    <i data-lucide="message-square" class="w-2.5 h-2.5 text-white"></i>
                                </span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h3 class="font-semibold text-gray-900 text-sm">New Message</h3>
                                        <p class="text-xs text-gray-500 mt-0.5">Ben Carter • Partnership Manager</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-gray-400">10 min ago</span>
                                        <button class="mark-read p-1 text-gray-400 hover:text-gray-600 rounded">
                                            <i data-lucide="check" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-700 mb-3">"Hi George, I've reviewed the partnership agreement and have a few questions about the student quotas. Can we schedule a call?"</p>
                                <button class="text-indigo-600 text-xs font-medium hover:text-indigo-700">Reply to message</button>
                            </div>
                        </div>
                    </div>

                    <!-- Group Activity -->
                    <div class="notification-item priority-low bg-white rounded-xl shadow-sm border border-gray-200 p-6 cursor-pointer" data-type="groups" data-read="true" onclick="markAsRead(this)">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i data-lucide="users" class="w-6 h-6 text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h3 class="font-semibold text-gray-900 text-sm">Group Activity</h3>
                                        <p class="text-xs text-gray-500 mt-0.5">Study Abroad Advisors - Canada</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-gray-400">2h ago</span>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-700 mb-3"><span class="font-medium">Lisa Chen</span> started a new discussion: "Best practices for virtual orientations"</p>
                                <button class="text-indigo-600 text-xs font-medium hover:text-indigo-700">View discussion</button>
                            </div>
                        </div>
                    </div>

                    <!-- System Notification -->
                    <div class="notification-item unread priority-medium bg-white rounded-xl shadow-sm border border-gray-200 p-6 cursor-pointer" data-type="system" data-read="false" onclick="markAsRead(this)">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i data-lucide="shield-check" class="w-6 h-6 text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h3 class="font-semibold text-gray-900 text-sm">Security Update</h3>
                                        <p class="text-xs text-gray-500 mt-0.5">System Administrator</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-gray-400">3h ago</span>
                                        <button class="mark-read p-1 text-gray-400 hover:text-gray-600 rounded">
                                            <i data-lucide="check" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-700 mb-3">Your account security has been enhanced with two-factor authentication. Review your new security settings.</p>
                                <button class="text-indigo-600 text-xs font-medium hover:text-indigo-700">Review settings</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Yesterday Section -->
            <div class="mb-8">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Yesterday</h2>
                <div class="space-y-2" id="yesterday-notifications">
                    <!-- Partnership Status Update -->
                    <div class="notification-item priority-low bg-white rounded-xl shadow-sm border border-gray-200 p-6 cursor-pointer" data-type="partnerships" data-read="true" onclick="markAsRead(this)">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i data-lucide="check-circle" class="w-6 h-6 text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h3 class="font-semibold text-gray-900 text-sm">Partnership Activated</h3>
                                        <p class="text-xs text-gray-500 mt-0.5">Oakridge Institute</p>
                                    </div>
                                    <span class="text-xs text-gray-400">1d ago</span>
                                </div>
                                <p class="text-sm text-gray-700 mb-3">Your partnership with <span class="font-medium">Oakridge Institute</span> is now active. You can begin student exchanges immediately.</p>
                                <button class="text-indigo-600 text-xs font-medium hover:text-indigo-700">View partnership details</button>
                            </div>
                        </div>
                    </div>

                    <!-- Event Reminder -->
                    <div class="notification-item priority-medium bg-white rounded-xl shadow-sm border border-gray-200 p-6 cursor-pointer" data-type="system" data-read="true" onclick="markAsRead(this)">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i data-lucide="calendar" class="w-6 h-6 text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h3 class="font-semibold text-gray-900 text-sm">Upcoming Event</h3>
                                        <p class="text-xs text-gray-500 mt-0.5">Education Fair 2025</p>
                                    </div>
                                    <span class="text-xs text-gray-400">1d ago</span>
                                </div>
                                <p class="text-sm text-gray-700 mb-3">Reminder: Education Fair 2025 planning meeting is scheduled for tomorrow at 2:00 PM EST.</p>
                                <button class="text-indigo-600 text-xs font-medium hover:text-indigo-700">Add to calendar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Earlier Section -->
            <div class="mb-8">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Earlier</h2>
                <div class="space-y-2" id="earlier-notifications">
                    <!-- Group Invitation -->
                    <div class="notification-item priority-low bg-white rounded-xl shadow-sm border border-gray-200 p-6 cursor-pointer" data-type="groups" data-read="true" onclick="markAsRead(this)">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i data-lucide="user-plus" class="w-6 h-6 text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h3 class="font-semibold text-gray-900 text-sm">Group Invitation</h3>
                                        <p class="text-xs text-gray-500 mt-0.5">Research Collaborations</p>
                                    </div>
                                    <span class="text-xs text-gray-400">3d ago</span>
                                </div>
                                <p class="text-sm text-gray-700 mb-3"><span class="font-medium">Dr. Sarah Mitchell</span> invited you to join the Research Collaborations group.</p>
                                <div class="flex items-center gap-3">
                                    <button class="bg-indigo-600 text-white text-xs font-medium px-4 py-2 rounded-lg hover:bg-indigo-700 transition-all">
                                        Accept
                                    </button>
                                    <button class="bg-gray-100 text-gray-700 text-xs font-medium px-4 py-2 rounded-lg hover:bg-gray-200 transition-all">
                                        Decline
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Load More -->
            <div class="text-center">
                <button onclick="loadMore()" class="text-indigo-600 hover:text-indigo-700 font-medium text-sm">
                    Load more notifications
                </button>
            </div>
        </div>
    </main>

    <script>
        // Authentication check
        function checkAuth() {
            const token = localStorage.getItem('authToken');
            if (!token || !isTokenValid(token)) {
                localStorage.removeItem('authToken');
                window.location.href = 'login.html';
                return false;
            }
            return token;
        }

        function isTokenValid(token) {
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                const now = Date.now() / 1000;
                return payload.exp > now;
            } catch (error) {
                return false;
            }
        }

        // Load user data
        async function loadUserData() {
            const token = checkAuth();
            if (!token) return;

            try {
                const response = await fetch('http://127.0.0.1:8000/api/users/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const user = await response.json();
                    
                    // Update sidebar user info
                    const userInitials = user.full_name.split(' ').map(n => n[0]).join('');
                    document.getElementById('sidebar-user-name').textContent = user.full_name;
                    document.getElementById('sidebar-avatar').src = user.profile_picture_url || `https://placehold.co/100x100/a78bfa/ffffff?text=${userInitials}`;

                    // Load organization data if user has one
                    if (user.organization_id) {
                        const orgResponse = await fetch(`http://127.0.0.1:8000/api/organizations/${user.organization_id}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        if (orgResponse.ok) {
                            const org = await orgResponse.json();
                            document.getElementById('sidebar-org-name').textContent = org.name;
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                if (error.message.includes('401')) {
                    localStorage.removeItem('authToken');
                    window.location.href = 'login.html';
                }
            }
        }

        // Notification functionality
        function markAsRead(element) {
            if (element.dataset.read === 'false') {
                element.dataset.read = 'true';
                element.classList.remove('unread');
                
                // Update unread count
                updateUnreadCount();
                
                // In a real app, this would make an API call to mark as read
                console.log('Marking notification as read');
            }
        }

        function markAllRead() {
            const unreadNotifications = document.querySelectorAll('.notification-item[data-read="false"]');
            unreadNotifications.forEach(notification => {
                notification.dataset.read = 'true';
                notification.classList.remove('unread');
            });
            
            updateUnreadCount();
            
            // In a real app, this would make an API call
            console.log('Marking all notifications as read');
        }

        function updateUnreadCount() {
            const unreadCount = document.querySelectorAll('.notification-item[data-read="false"]').length;
            const badge = document.querySelector('.bg-red-500');
            if (badge) {
                badge.textContent = unreadCount;
                if (unreadCount === 0) {
                    badge.style.display = 'none';
                }
            }
            
            // Update filter counts
            updateFilterCounts();
        }

        function updateFilterCounts() {
            const allCount = document.querySelectorAll('.notification-item').length;
            const unreadCount = document.querySelectorAll('.notification-item[data-read="false"]').length;
            const partnershipsCount = document.querySelectorAll('.notification-item[data-type="partnerships"]').length;
            const messagesCount = document.querySelectorAll('.notification-item[data-type="messages"]').length;
            const groupsCount = document.querySelectorAll('.notification-item[data-type="groups"]').length;
            const systemCount = document.querySelectorAll('.notification-item[data-type="system"]').length;

            // Update filter button counts
            const filters = {
                'all': allCount,
                'unread': unreadCount,
                'partnerships': partnershipsCount,
                'messages': messagesCount,
                'groups': groupsCount,
                'system': systemCount
            };

            Object.keys(filters).forEach(filter => {
                const button = document.querySelector(`[data-filter="${filter}"]`);
                if (button) {
                    const badge = button.querySelector('span');
                    if (badge) {
                        badge.textContent = filters[filter];
                    }
                }
            });
        }

        // Filter functionality
        function setupFiltering() {
            const filterButtons = document.querySelectorAll('.notification-filter-btn');
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    filterButtons.forEach(btn => {
                        btn.classList.remove('active', 'bg-white', 'text-gray-900', 'shadow-sm');
                        btn.classList.add('text-gray-600', 'hover:text-gray-900');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('active', 'bg-white', 'text-gray-900', 'shadow-sm');
                    this.classList.remove('text-gray-600', 'hover:text-gray-900');
                    
                    // Filter notifications
                    const filter = this.dataset.filter;
                    filterNotifications(filter);
                });
            });
        }

        function filterNotifications(filter) {
            const notifications = document.querySelectorAll('.notification-item');
            
            notifications.forEach(notification => {
                let shouldShow = false;
                
                switch(filter) {
                    case 'all':
                        shouldShow = true;
                        break;
                    case 'unread':
                        shouldShow = notification.dataset.read === 'false';
                        break;
                    case 'partnerships':
                        shouldShow = notification.dataset.type === 'partnerships';
                        break;
                    case 'messages':
                        shouldShow = notification.dataset.type === 'messages';
                        break;
                    case 'groups':
                        shouldShow = notification.dataset.type === 'groups';
                        break;
                    case 'system':
                        shouldShow = notification.dataset.type === 'system';
                        break;
                }
                
                notification.style.display = shouldShow ? 'block' : 'none';
                
                // Also hide/show parent section if no notifications are visible
                const section = notification.closest('div[id$="-notifications"]');
                if (section) {
                    const visibleNotifications = section.querySelectorAll('.notification-item[style="display: block"], .notification-item:not([style*="display: none"])');
                    const sectionHeader = section.previousElementSibling;
                    if (visibleNotifications.length === 0) {
                        section.style.display = 'none';
                        if (sectionHeader && sectionHeader.tagName === 'H2') {
                            sectionHeader.style.display = 'none';
                        }
                    } else {
                        section.style.display = 'block';
                        if (sectionHeader && sectionHeader.tagName === 'H2') {
                            sectionHeader.style.display = 'block';
                        }
                    }
                }
            });
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('search-notifications');
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const notifications = document.querySelectorAll('.notification-item');
                
                notifications.forEach(notification => {
                    const title = notification.querySelector('h3')?.textContent.toLowerCase() || '';
                    const content = notification.querySelector('p')?.textContent.toLowerCase() || '';
                    const sender = notification.querySelector('.text-xs.text-gray-500')?.textContent.toLowerCase() || '';
                    
                    if (title.includes(searchTerm) || content.includes(searchTerm) || sender.includes(searchTerm)) {
                        notification.style.display = 'block';
                    } else {
                        notification.style.display = 'none';
                    }
                });
            });
        }

        // Actions
        function openSettings() {
            alert('Notification settings functionality coming soon!');
        }

        function loadMore() {
            // In a real app, this would load more notifications from the API
            alert('Load more functionality would fetch additional notifications from the server.');
        }

        // Auto-update timestamps
        function updateTimestamps() {
            const timeElements = document.querySelectorAll('[data-timestamp]');
            const now = new Date();
            
            timeElements.forEach(element => {
                const timestamp = new Date(element.dataset.timestamp);
                const diff = now - timestamp;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);
                
                let timeText = '';
                if (minutes < 1) {
                    timeText = 'Just now';
                } else if (minutes < 60) {
                    timeText = `${minutes}m ago`;
                } else if (hours < 24) {
                    timeText = `${hours}h ago`;
                } else {
                    timeText = `${days}d ago`;
                }
                
                element.textContent = timeText;
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            setupFiltering();
            setupSearch();
            updateUnreadCount();
            
            // Initialize Lucide icons
            lucide.createIcons();
            
            // Update timestamps every minute
            setInterval(updateTimestamps, 60000);
            
            // Set up click handlers for notification actions
            document.querySelectorAll('.notification-item button').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent marking as read when clicking buttons
                });
            });
        });
    </script>
</body>
</html>